# 관리 기능 설계 문서

## 1. 개요

### 1.1 목적
SillyTavern API의 나머지 관리 기능들을 웹 기반 관리자 페이지에서 관리할 수 있도록 구축한다. 현재 구현된 캐릭터 관리와 설정 관리 외의 모든 기능을 포함한다.

### 1.2 범위
- 채팅 관리 (개별 채팅, 그룹 채팅)
- 미디어 관리 (이미지, 배경, 아바타)
- 확장 기능 관리 (설치, 제거, 활성화/비활성화)
- 테마 관리
- 빠른 응답 관리
- 통계/분석
- 백업/복원
- 프롬프트 관리
- API 테스트

### 1.3 현재 구현 상태
- ✅ 캐릭터 관리 (CRUD, 복제)
- ✅ 설정 관리 (모든 설정 탭)
- ✅ World Info 항목 관리
- ❌ 채팅 관리
- ❌ 그룹 관리
- ❌ 미디어 관리
- ❌ 확장 기능 설치/관리
- ❌ 테마 관리
- ❌ 빠른 응답 관리
- ❌ 통계/분석
- ❌ 백업/복원

---

## 2. 채팅 관리

### 2.1 목적
사용자가 생성한 모든 채팅 내역을 관리하고, 검색, 필터링, 내보내기/가져오기 기능을 제공한다.

### 2.2 기능 목록

#### 2.2.1 채팅 목록 조회
- 모든 채팅 목록 표시
- 캐릭터별 필터링
- 날짜별 정렬 (최신순/오래된순)
- 검색 기능 (채팅 제목, 메시지 내용)

#### 2.2.2 채팅 상세 조회
- 채팅 메시지 전체 내용 표시
- 메시지 수정/삭제
- 메시지 재생성 (regenerate)

#### 2.2.3 채팅 관리
- 채팅 이름 변경
- 채팅 삭제
- 채팅 복제
- 채팅 내보내기 (JSON, 텍스트)
- 채팅 가져오기

#### 2.2.4 채팅 검색
- 전체 채팅에서 키워드 검색
- 특정 캐릭터의 채팅만 검색
- 날짜 범위 검색

### 2.3 UI/UX 설계

#### 2.3.1 채팅 목록 페이지
```
┌─────────────────────────────────────────────────┐
│ 채팅 관리                                        │
├─────────────────────────────────────────────────┤
│ [검색: ________] [필터: 캐릭터 ▼] [정렬: 최신순 ▼]│
├─────────────────────────────────────────────────┤
│ ┌─────────────┬─────────────┬─────────────┐   │
│ │ [캐릭터 이미지]│ 채팅 제목    │ 마지막 메시지  │   │
│ │ 캐릭터 이름  │ 날짜/시간    │ [편집][삭제]│   │
│ └─────────────┴─────────────┴─────────────┘   │
│ ...                                             │
└─────────────────────────────────────────────────┘
```

#### 2.3.2 채팅 상세 페이지
- 채팅 메시지 목록 (스크롤 가능)
- 메시지별 편집/삭제 버튼
- 새 메시지 입력 (선택사항, 모바일 앱에서 주로 사용)

### 2.4 데이터 구조

```typescript
interface Chat {
  chat_id: string;
  character_id?: string;
  character_name?: string;
  character_avatar?: string;
  title: string;
  created: number; // timestamp
  updated: number; // timestamp
  message_count: number;
  last_message?: string;
  messages?: ChatMessage[];
}

interface ChatMessage {
  id: string;
  name: string;
  is_user: boolean;
  is_system: boolean;
  mes: string; // 메시지 내용
  send_date?: number;
  [key: string]: any;
}
```

### 2.5 API 엔드포인트

- `POST /api/chats/get` - 채팅 목록 조회
- `POST /api/chats/get` - 특정 채팅 조회 (chat_id 포함)
- `POST /api/chats/save` - 채팅 저장
- `POST /api/chats/rename` - 채팅 이름 변경
- `POST /api/chats/delete` - 채팅 삭제
- `POST /api/chats/search` - 채팅 검색
- `POST /api/chats/import` - 채팅 가져오기
- `POST /api/chats/export` - 채팅 내보내기

### 2.6 구현 단계

**Phase 1: 기본 구조**
1. 채팅 목록 페이지 생성
2. 채팅 목록 API 연동
3. 기본 UI 구성

**Phase 2: 채팅 상세**
1. 채팅 상세 페이지 생성
2. 메시지 표시
3. 메시지 편집/삭제

**Phase 3: 검색 및 필터링**
1. 검색 기능 구현
2. 필터링 기능 구현
3. 정렬 기능 구현

**Phase 4: 가져오기/내보내기**
1. 채팅 내보내기 (JSON, 텍스트)
2. 채팅 가져오기
3. 파일 업로드 처리

---

## 3. 그룹 채팅 관리

### 3.1 목적
여러 캐릭터가 참여하는 그룹 채팅을 관리한다.

### 3.2 기능 목록

#### 3.2.1 그룹 관리
- 그룹 생성
- 그룹 편집 (이름, 참여 캐릭터)
- 그룹 삭제
- 그룹 목록 조회

#### 3.2.2 그룹 채팅 관리
- 그룹 채팅 조회
- 그룹 채팅 저장
- 그룹 채팅 삭제
- 그룹 채팅 가져오기/내보내기

### 3.3 UI/UX 설계

#### 3.3.1 그룹 목록 페이지
- 그룹 카드 형식 표시
- 그룹 이름, 참여 캐릭터 수, 마지막 활동 시간
- 그룹 생성 버튼

#### 3.3.2 그룹 편집 모달
- 그룹 이름 입력
- 참여 캐릭터 선택 (다중 선택)
- 저장/취소 버튼

### 3.4 데이터 구조

```typescript
interface Group {
  group_id: string;
  name: string;
  members: string[]; // character_id 배열
  created: number;
  updated: number;
  chat_count?: number;
}

interface GroupChat {
  chat_id: string;
  group_id: string;
  title: string;
  created: number;
  updated: number;
  messages: ChatMessage[];
}
```

### 3.5 API 엔드포인트

- `POST /api/groups/all` - 모든 그룹 조회
- `POST /api/groups/create` - 그룹 생성
- `POST /api/groups/edit` - 그룹 편집
- `POST /api/groups/delete` - 그룹 삭제
- `POST /api/chats/group/get` - 그룹 채팅 조회
- `POST /api/chats/group/save` - 그룹 채팅 저장
- `POST /api/chats/group/delete` - 그룹 채팅 삭제
- `POST /api/chats/group/import` - 그룹 채팅 가져오기

### 3.6 구현 단계

**Phase 1: 그룹 관리**
1. 그룹 목록 페이지
2. 그룹 생성/편집/삭제

**Phase 2: 그룹 채팅**
1. 그룹 채팅 목록
2. 그룹 채팅 상세
3. 그룹 채팅 관리 기능

---

## 4. 미디어 관리

### 4.1 목적
이미지, 배경, 아바타 등 미디어 파일을 업로드하고 관리한다.

### 4.2 기능 목록

#### 4.2.1 이미지 관리
- 이미지 업로드
- 이미지 목록 조회 (폴더별)
- 이미지 삭제
- 이미지 미리보기

#### 4.2.2 배경 관리
- 배경 이미지 업로드
- 배경 목록 조회
- 배경 이름 변경
- 배경 삭제
- 배경 미리보기

#### 4.2.3 아바타 관리
- 사용자 아바타 업로드
- 아바타 목록 조회
- 아바타 삭제
- 아바타 선택 (설정에 반영)

### 4.3 UI/UX 설계

#### 4.3.1 미디어 관리 페이지 (탭 구조)
```
┌─────────────────────────────────────────────────┐
│ 미디어 관리                                      │
├─────────────────────────────────────────────────┤
│ [이미지] [배경] [아바타]                        │
├─────────────────────────────────────────────────┤
│ [업로드] [폴더: 전체 ▼]                          │
│ ┌──────┐ ┌──────┐ ┌──────┐                      │
│ │ 이미지│ │ 이미지│ │ 이미지│                      │
│ │ 이름  │ │ 이름  │ │ 이름  │                      │
│ └──────┘ └──────┘ └──────┘                      │
└─────────────────────────────────────────────────┘
```

### 4.4 데이터 구조

```typescript
interface ImageFile {
  name: string;
  path: string;
  url: string;
  size?: number;
  folder?: string;
}

interface Background {
  name: string;
  url: string;
  thumbnail?: string;
}

interface Avatar {
  name: string;
  url: string;
  thumbnail?: string;
}
```

### 4.5 API 엔드포인트

**이미지**
- `POST /api/images/upload` - 이미지 업로드
- `POST /api/images/list/:folder` - 폴더별 이미지 목록

**배경**
- `POST /api/backgrounds/all` - 모든 배경 조회
- `POST /api/backgrounds/upload` - 배경 업로드
- `POST /api/backgrounds/rename` - 배경 이름 변경
- `POST /api/backgrounds/delete` - 배경 삭제

**아바타**
- `POST /api/avatars/get` - 아바타 목록 조회
- `POST /api/avatars/upload` - 아바타 업로드
- `POST /api/avatars/delete` - 아바타 삭제

### 4.6 구현 단계

**Phase 1: 이미지 관리**
1. 이미지 업로드 기능
2. 이미지 목록 표시
3. 이미지 삭제 기능

**Phase 2: 배경 관리**
1. 배경 업로드
2. 배경 목록 및 관리
3. 배경 이름 변경/삭제

**Phase 3: 아바타 관리**
1. 아바타 업로드
2. 아바타 목록 및 관리
3. 아바타 선택 기능 (설정 연동)

---

## 5. 확장 기능 관리

### 5.1 목적
SillyTavern 확장 기능을 설치, 제거, 활성화/비활성화하고 설정을 관리한다.

### 5.2 기능 목록

#### 5.2.1 확장 기능 목록
- 설치 가능한 확장 기능 목록 조회
- 설치된 확장 기능 목록 조회
- 확장 기능 상세 정보 (설명, 버전, 의존성)

#### 5.2.2 확장 기능 설치/제거
- 확장 기능 설치
- 확장 기능 제거
- 확장 기능 업데이트

#### 5.2.3 확장 기능 활성화/비활성화
- 확장 기능 활성화
- 확장 기능 비활성화
- 확장 기능 설정 (설정 페이지와 연동)

### 5.3 UI/UX 설계

#### 5.3.1 확장 기능 관리 페이지
```
┌─────────────────────────────────────────────────┐
│ 확장 기능 관리                                  │
├─────────────────────────────────────────────────┤
│ [설치됨] [사용 가능] [검색: ________]           │
├─────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────┐   │
│ │ 확장 기능 이름                              │   │
│ │ 설명...                                     │   │
│ │ [활성화/비활성화] [설정] [제거]            │   │
│ └───────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

### 5.4 데이터 구조

```typescript
interface Extension {
  id: string;
  name: string;
  description: string;
  version: string;
  author?: string;
  enabled: boolean;
  installed: boolean;
  dependencies?: string[];
  settings?: Record<string, any>;
}
```

### 5.5 API 엔드포인트

- `GET /api/extensions` - 확장 기능 목록 조회 (추정)
- `POST /api/extensions/install` - 확장 기능 설치 (추정)
- `POST /api/extensions/uninstall` - 확장 기능 제거 (추정)
- `POST /api/extensions/enable` - 확장 기능 활성화 (추정)
- `POST /api/extensions/disable` - 확장 기능 비활성화 (추정)

**참고**: 확장 기능 API는 SillyTavern 서버 코드를 확인하여 정확한 엔드포인트를 파악해야 함.

### 5.6 구현 단계

**Phase 1: 확장 기능 목록**
1. 확장 기능 목록 조회
2. 설치/미설치 구분 표시
3. 기본 정보 표시

**Phase 2: 설치/제거**
1. 확장 기능 설치 기능
2. 확장 기능 제거 기능
3. 설치 상태 업데이트

**Phase 3: 활성화/비활성화**
1. 확장 기능 활성화/비활성화
2. 설정 페이지와 연동

---

## 6. 테마 관리

### 6.1 목적
SillyTavern의 테마를 선택하고 커스터마이징한다.

### 6.2 기능 목록

#### 6.2.1 테마 선택
- 기본 테마 목록 표시
- 테마 미리보기
- 테마 적용

#### 6.2.2 테마 커스터마이징
- 테마 색상 변경
- 테마 저장
- 커스텀 테마 생성

### 6.3 UI/UX 설계

#### 6.3.1 테마 관리 페이지
- 테마 카드 그리드 형식
- 각 테마의 미리보기 이미지
- 테마 선택 버튼
- 커스터마이징 버튼

### 6.4 데이터 구조

```typescript
interface Theme {
  id: string;
  name: string;
  colors: {
    primary: string;
    secondary: string;
    background: string;
    text: string;
    // ... 기타 색상
  };
  preview?: string; // 미리보기 이미지 URL
}
```

### 6.5 API 엔드포인트

- `POST /api/themes/save` - 테마 저장
- 테마 목록 조회 API 확인 필요

### 6.6 구현 단계

**Phase 1: 테마 선택**
1. 테마 목록 조회
2. 테마 미리보기
3. 테마 적용 기능

**Phase 2: 테마 커스터마이징**
1. 색상 편집기
2. 커스텀 테마 저장

---

## 7. 빠른 응답 관리

### 7.1 목적
자주 사용하는 메시지를 빠른 응답으로 저장하고 관리한다.

### 7.2 기능 목록

#### 7.2.1 빠른 응답 관리
- 빠른 응답 추가
- 빠른 응답 편집
- 빠른 응답 삭제
- 빠른 응답 목록 조회

### 7.3 UI/UX 설계

#### 7.3.1 빠른 응답 관리 페이지
- 빠른 응답 목록 (카드 형식)
- 각 항목에 편집/삭제 버튼
- 새 빠른 응답 추가 버튼

### 7.4 데이터 구조

```typescript
interface QuickReply {
  id: string;
  name: string;
  message: string;
  created: number;
  updated: number;
}
```

### 7.5 API 엔드포인트

- `POST /api/quick-replies/save` - 빠른 응답 저장
- `POST /api/quick-replies/delete` - 빠른 응답 삭제
- 빠른 응답 목록 조회 API 확인 필요

### 7.6 구현 단계

**Phase 1: 기본 CRUD**
1. 빠른 응답 목록 조회
2. 빠른 응답 추가/편집/삭제

---

## 8. 통계/분석

### 8.1 목적
채팅 사용 통계, 캐릭터 사용 통계, 성능 분석 등을 제공한다.

### 8.2 기능 목록

#### 8.2.1 채팅 통계
- 총 채팅 수
- 총 메시지 수
- 가장 많이 사용한 캐릭터
- 일별/주별/월별 채팅 통계

#### 8.2.2 캐릭터 통계
- 캐릭터별 채팅 수
- 캐릭터별 메시지 수
- 캐릭터 사용 빈도

#### 8.2.3 성능 분석
- API 응답 시간 통계
- 토큰 사용량 통계
- 에러 발생 통계

### 8.3 UI/UX 설계

#### 8.3.1 통계 대시보드
- 대시보드 형식
- 차트/그래프 표시
- 기간 선택 (일/주/월/전체)

### 8.4 데이터 구조

```typescript
interface Stats {
  total_chats: number;
  total_messages: number;
  total_characters: number;
  character_usage: {
    character_id: string;
    character_name: string;
    chat_count: number;
    message_count: number;
  }[];
  daily_stats: {
    date: string;
    chats: number;
    messages: number;
  }[];
  api_stats?: {
    response_time_avg: number;
    token_usage: number;
    error_count: number;
  };
}
```

### 8.5 API 엔드포인트

- `POST /api/stats/get` - 통계 조회
- `POST /api/stats/recreate` - 통계 재생성
- `POST /api/stats/update` - 통계 업데이트

### 8.6 구현 단계

**Phase 1: 기본 통계**
1. 통계 데이터 조회
2. 기본 통계 표시 (숫자, 리스트)

**Phase 2: 차트/그래프**
1. 차트 라이브러리 통합 (예: Chart.js, Recharts)
2. 시각화 구현

---

## 9. 백업/복원

### 9.1 목적
전체 데이터를 백업하고 복원한다.

### 9.2 기능 목록

#### 9.2.1 백업
- 전체 데이터 백업 (캐릭터, 채팅, 설정 등)
- 선택적 백업 (특정 항목만)
- 백업 파일 다운로드

#### 9.2.2 복원
- 백업 파일 업로드
- 백업 파일 검증
- 데이터 복원

#### 9.2.3 자동 백업
- 자동 백업 스케줄 설정
- 백업 파일 관리 (오래된 백업 삭제)

### 9.3 UI/UX 설계

#### 9.3.1 백업/복원 페이지
- 백업 생성 버튼
- 백업 파일 목록
- 복원 버튼
- 자동 백업 설정

### 9.4 데이터 구조

```typescript
interface Backup {
  id: string;
  name: string;
  created: number;
  size: number;
  includes: {
    characters: boolean;
    chats: boolean;
    settings: boolean;
    world_info: boolean;
    // ... 기타
  };
}
```

### 9.5 API 엔드포인트

- `POST /api/backups/create` - 백업 생성 (추정)
- `POST /api/backups/list` - 백업 목록 조회 (추정)
- `POST /api/backups/restore` - 백업 복원 (추정)
- `POST /api/backups/delete` - 백업 삭제 (추정)

**참고**: 백업 API는 SillyTavern 서버 코드를 확인하여 정확한 엔드포인트를 파악해야 함.

### 9.6 구현 단계

**Phase 1: 수동 백업/복원**
1. 백업 생성 기능
2. 백업 파일 다운로드
3. 백업 파일 업로드 및 복원

**Phase 2: 자동 백업**
1. 자동 백업 스케줄 설정
2. 백업 파일 관리

---

## 10. 프롬프트 관리

### 10.1 목적
시스템 프롬프트, 프롬프트 템플릿을 관리한다.

### 10.2 기능 목록

#### 10.2.1 프롬프트 템플릿
- 프롬프트 템플릿 생성/편집/삭제
- 프롬프트 템플릿 목록 조회
- 프롬프트 템플릿 적용

#### 10.2.2 시스템 프롬프트
- 시스템 프롬프트 편집
- 시스템 프롬프트 저장

### 10.3 UI/UX 설계

#### 10.3.1 프롬프트 관리 페이지
- 프롬프트 템플릿 목록
- 템플릿 편집기 (코드 에디터)
- 미리보기 기능

### 10.4 데이터 구조

```typescript
interface PromptTemplate {
  id: string;
  name: string;
  content: string;
  variables?: string[]; // 사용 가능한 변수 목록
  created: number;
  updated: number;
}
```

### 10.5 API 엔드포인트

- 프롬프트 관련 API는 설정 API에 포함되어 있을 수 있음
- 별도 API 확인 필요

### 10.6 구현 단계

**Phase 1: 프롬프트 템플릿**
1. 템플릿 목록 조회
2. 템플릿 편집기 구현
3. 템플릿 저장/삭제

**Phase 2: 시스템 프롬프트**
1. 시스템 프롬프트 편집
2. 설정과 연동

---

## 11. API 테스트

### 11.1 목적
API 연결을 테스트하고 모델 목록을 조회한다.

### 11.2 기능 목록

#### 11.2.1 연결 테스트
- API 연결 테스트
- 인증 테스트
- 응답 시간 측정

#### 11.2.2 모델 목록 조회
- 사용 가능한 모델 목록 조회
- 모델 정보 표시

### 11.3 UI/UX 설계

#### 11.3.1 API 테스트 페이지
- API 선택 (OpenAI, TextGen 등)
- 연결 테스트 버튼
- 테스트 결과 표시
- 모델 목록 표시

### 11.4 구현 단계

**Phase 1: 연결 테스트**
1. API 연결 테스트 기능
2. 결과 표시

**Phase 2: 모델 목록**
1. 모델 목록 조회
2. 모델 정보 표시

---

## 12. 구현 우선순위

### 12.1 높은 우선순위
1. **채팅 관리** - 사용자가 가장 많이 사용하는 기능
2. **미디어 관리** - 이미지/배경/아바타 관리 필요
3. **그룹 관리** - 그룹 채팅 기능 지원

### 12.2 중간 우선순위
4. **확장 기능 관리** - 확장 기능 설치/관리
5. **테마 관리** - UI 커스터마이징
6. **빠른 응답 관리** - 편의 기능

### 12.3 낮은 우선순위
7. **통계/분석** - 부가 기능
8. **백업/복원** - 고급 기능
9. **프롬프트 관리** - 고급 사용자용
10. **API 테스트** - 디버깅용

---

## 13. 공통 컴포넌트

### 13.1 재사용 가능한 컴포넌트
- **DataTable**: 목록 표시용 테이블 컴포넌트
- **SearchBar**: 검색 바 컴포넌트
- **FilterDropdown**: 필터 드롭다운 컴포넌트
- **FileUploader**: 파일 업로드 컴포넌트
- **ImagePreview**: 이미지 미리보기 컴포넌트
- **ConfirmDialog**: 확인 다이얼로그 컴포넌트
- **LoadingSpinner**: 로딩 스피너 컴포넌트

### 13.2 공통 유틸리티
- **dateUtils**: 날짜 포맷팅 유틸리티
- **fileUtils**: 파일 처리 유틸리티
- **validationUtils**: 검증 유틸리티

---

## 14. 주의사항

### 14.1 보안
- 파일 업로드 시 파일 타입 및 크기 검증
- 민감한 정보 (API 키 등)는 표시하지 않음
- CSRF 토큰을 모든 API 요청에 포함

### 14.2 성능
- 대량 데이터 조회 시 페이지네이션 적용
- 이미지 미리보기 시 썸네일 사용
- 통계 데이터는 캐싱 고려

### 14.3 사용자 경험
- 로딩 상태 명확히 표시
- 에러 메시지 명확히 표시
- 작업 완료 피드백 제공
- 확인 다이얼로그로 실수 방지

---

## 15. 참고사항

### 15.1 API 엔드포인트 확인 필요
일부 API 엔드포인트는 SillyTavern 서버 코드를 직접 확인하여 정확한 엔드포인트와 요청/응답 형식을 파악해야 함.

### 15.2 동적 기능
확장 기능, 테마 등은 런타임에 동적으로 로드될 수 있으므로, 동적 UI 생성이 필요할 수 있음.

### 15.3 모바일 앱 연동
일부 기능 (예: 빠른 응답)은 모바일 앱에서도 사용될 수 있으므로, API 설계 시 모바일 앱 사용을 고려해야 함.

